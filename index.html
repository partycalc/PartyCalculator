<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="–ß–µ—Å—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫ —Å –æ–ø–ª–∞—Ç–æ–π —á–µ—Ä–µ–∑ –°–ë–ü">
    <title>Party Calculator - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤</title>
    
    <!-- Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel –¥–ª—è JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overscroll-behavior: none;
            background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // –ü—Ä–æ—Å—Ç—ã–µ SVG –∏–∫–æ–Ω–∫–∏
        const X = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );
        
        const Plus = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );
        
        const Users = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );
        
        const ShoppingCart = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
        );
        
        const PieChart = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
            </svg>
        );
        
        const Calculator = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        );
        
        const Info = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const RotateCcw = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
            </svg>
        );
        
        const Send = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
            </svg>
        );
        
        const Check = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
        );
        
        const Clock = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const AlertCircle = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const Phone = ({ size = 20, className = '' }) => (
            <svg className={className} width={size} height={size} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
        );

        const PartyCalculatorTelegram = () => {
          const [screen, setScreen] = useState('splash');
          const [activeTab, setActiveTab] = useState('participants');
          const [participants, setParticipants] = useState([]);
          const [purchases, setPurchases] = useState([]);
          const [consumption, setConsumption] = useState({});
          const [settlements, setSettlements] = useState([]);
          const [paymentStatuses, setPaymentStatuses] = useState({});
          const [showHelp, setShowHelp] = useState(false);
          const [showReset, setShowReset] = useState(false);

          const [participantForm, setParticipantForm] = useState({ name: '', phone: '' });
          const [editingParticipant, setEditingParticipant] = useState(null);

          const [purchaseForm, setPurchaseForm] = useState({ name: '', price: '', quantity: '', buyer: '' });
          const [editingPurchase, setEditingPurchase] = useState(null);

          useEffect(() => {
            const timer = setTimeout(() => setScreen('main'), 2500);
            return () => clearTimeout(timer);
          }, []);

          const addParticipant = () => {
            if (!participantForm.name.trim()) return;
            
            if (editingParticipant !== null) {
              setParticipants(participants.map((p, i) => 
                i === editingParticipant ? { 
                  ...p, 
                  name: participantForm.name, 
                  phone: participantForm.phone 
                } : p
              ));
              setEditingParticipant(null);
            } else {
              const newParticipant = {
                id: Date.now(),
                name: participantForm.name,
                phone: participantForm.phone || ''
              };
              setParticipants([...participants, newParticipant]);
            }
            setParticipantForm({ name: '', phone: '' });
          };

          const deleteParticipant = (index) => {
            const participant = participants[index];
            setParticipants(participants.filter((_, i) => i !== index));
            setPurchases(purchases.filter(p => p.buyer !== participant.name));
            
            const newConsumption = {};
            Object.keys(consumption).forEach(key => {
              if (!key.includes(`-${participant.id}`)) {
                newConsumption[key] = consumption[key];
              }
            });
            setConsumption(newConsumption);
          };

          const addPurchase = () => {
            if (!purchaseForm.name || !purchaseForm.price || !purchaseForm.quantity || !purchaseForm.buyer) return;
            
            const newPurchase = {
              id: Date.now(),
              name: purchaseForm.name,
              price: parseFloat(purchaseForm.price),
              quantity: parseFloat(purchaseForm.quantity),
              buyer: purchaseForm.buyer,
              total: parseFloat(purchaseForm.price) * parseFloat(purchaseForm.quantity)
            };

            if (editingPurchase !== null) {
              setPurchases(purchases.map((p, i) => i === editingPurchase ? newPurchase : p));
              setEditingPurchase(null);
            } else {
              setPurchases([...purchases, newPurchase]);
            }
            
            setPurchaseForm({ name: '', price: '', quantity: '', buyer: '' });
          };

          const deletePurchase = (index) => {
            setPurchases(purchases.filter((_, i) => i !== index));
          };

          const getGroupedPurchases = () => {
            const grouped = {};
            purchases.forEach(p => {
              const key = `${p.name}-${p.price}`;
              if (!grouped[key]) {
                grouped[key] = { name: p.name, price: p.price, totalQuantity: 0, key };
              }
              grouped[key].totalQuantity += p.quantity;
            });
            return Object.values(grouped);
          };

          const updateConsumption = (groupKey, participantId, value) => {
            const key = `${groupKey}-${participantId}`;
            setConsumption({ ...consumption, [key]: parseFloat(value) || 0 });
          };

          const distributeEvenly = (group) => {
            const perPerson = group.totalQuantity / participants.length;
            const newConsumption = { ...consumption };
            participants.forEach(p => {
              newConsumption[`${group.key}-${p.id}`] = perPerson;
            });
            setConsumption(newConsumption);
          };

          const distributeAllEvenly = () => {
            const groups = getGroupedPurchases();
            const newConsumption = { ...consumption };
            groups.forEach(group => {
              const perPerson = group.totalQuantity / participants.length;
              participants.forEach(p => {
                newConsumption[`${group.key}-${p.id}`] = perPerson;
              });
            });
            setConsumption(newConsumption);
          };

          const getConsumptionStatus = (group) => {
            const total = participants.reduce((sum, p) => 
              sum + (consumption[`${group.key}-${p.id}`] || 0), 0
            );
            const diff = Math.abs(total - group.totalQuantity);
            if (diff < 0.01) return 'correct';
            if (total < group.totalQuantity) return 'under';
            return 'over';
          };

          const calculateSettlements = () => {
            const balances = {};
            
            participants.forEach(p => {
              balances[p.name] = { 
                spent: 0, 
                owes: 0, 
                phone: p.phone 
              };
            });

            purchases.forEach(purchase => {
              balances[purchase.buyer].spent += purchase.total;
            });

            const groups = getGroupedPurchases();
            groups.forEach(group => {
              participants.forEach(p => {
                const consumed = consumption[`${group.key}-${p.id}`] || 0;
                balances[p.name].owes += consumed * group.price;
              });
            });

            const results = Object.entries(balances).map(([name, data]) => ({
              name,
              phone: data.phone,
              spent: Math.round(data.spent * 100) / 100,
              owes: Math.round(data.owes * 100) / 100,
              balance: Math.round((data.spent - data.owes) * 100) / 100
            }));

            let debtors = results.filter(r => r.balance < 0).map(r => ({ 
              ...r, 
              amount: Math.abs(r.balance) 
            }));
            let creditors = results.filter(r => r.balance > 0);

            const transactions = [];
            
            while (debtors.length > 0 && creditors.length > 0) {
              const debtor = debtors[0];
              const creditor = creditors[0];
              const amount = Math.min(debtor.amount, creditor.balance);

              transactions.push({
                id: `${debtor.name}-${creditor.name}-${Date.now()}`,
                from: debtor.name,
                fromPhone: debtor.phone,
                to: creditor.name,
                toPhone: creditor.phone,
                amount: Math.round(amount * 100) / 100
              });

              debtor.amount -= amount;
              creditor.balance -= amount;

              if (debtor.amount < 0.01) debtors.shift();
              if (creditor.balance < 0.01) creditors.shift();
            }

            setSettlements(transactions);
            const statuses = {};
            transactions.forEach(t => statuses[t.id] = 'unpaid');
            setPaymentStatuses(statuses);
          };

          const getResults = () => {
            const balances = {};
            participants.forEach(p => {
              balances[p.name] = { spent: 0, owes: 0, phone: p.phone };
            });
            purchases.forEach(purchase => {
              balances[purchase.buyer].spent += purchase.total;
            });
            const groups = getGroupedPurchases();
            groups.forEach(group => {
              participants.forEach(p => {
                const consumed = consumption[`${group.key}-${p.id}`] || 0;
                balances[p.name].owes += consumed * group.price;
              });
            });
            return Object.entries(balances).map(([name, data]) => ({
              name,
              phone: data.phone,
              spent: Math.round(data.spent * 100) / 100,
              owes: Math.round(data.owes * 100) / 100,
              balance: Math.round((data.spent - data.owes) * 100) / 100
            }));
          };

          const initiatePayment = (transaction) => {
            const phone = transaction.toPhone?.replace(/\D/g, '') || '';
            const amount = Math.round(transaction.amount * 100);
            
            let sbpLink;
            if (phone && phone.length >= 10) {
              sbpLink = `https://qr.nspk.ru/proxyapp.htm?type=02&bank=100000000111&sum=${amount}&cur=RUB&phone=${phone}&crc=0000`;
            } else {
              sbpLink = `https://qr.nspk.ru/proxyapp.htm?type=02&bank=100000000111&sum=${amount}&cur=RUB&crc=0000`;
            }
            
            window.open(sbpLink, '_blank');
            setTimeout(() => {
              updatePaymentStatus(transaction.id, 'pending');
            }, 500);
          };

          const updatePaymentStatus = (transactionId, status) => {
            setPaymentStatuses({ ...paymentStatuses, [transactionId]: status });
          };

          const generateShareText = () => {
            let text = 'üéâ *Party Calculator - –ò—Ç–æ–≥–∏*\n\n';
            
            const results = getResults();
            text += 'üí∞ *–ë–∞–ª–∞–Ω—Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:*\n';
            results.forEach(r => {
              const icon = r.balance > 0 ? '‚úÖ' : r.balance < 0 ? '‚ùå' : '‚ûñ';
              text += `${icon} ${r.name}: ${r.balance > 0 ? '+' : ''}${r.balance.toFixed(2)}‚ÇΩ\n`;
            });
            
            text += '\nüîÑ *–ò—Ç–æ–≥–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã:*\n';
            settlements.forEach(s => {
              const statusIcon = paymentStatuses[s.id] === 'paid' ? '‚úÖ' : 
                                paymentStatuses[s.id] === 'pending' ? '‚è≥' : '‚ùå';
              const phoneInfo = s.toPhone ? ` (${s.toPhone})` : '';
              text += `${statusIcon} ${s.from} ‚Üí ${s.to}${phoneInfo}: ${s.amount.toFixed(2)}‚ÇΩ\n`;
            });
            
            return text;
          };

          const shareToMessenger = (platform) => {
            const text = generateShareText();
            
            if (platform === 'telegram') {
              const telegramUrl = `https://t.me/share/url?url=&text=${encodeURIComponent(text)}`;
              window.open(telegramUrl, '_blank');
            } else {
              const encodedText = encodeURIComponent(text);
              const links = {
                whatsapp: `https://wa.me/?text=${encodedText}`,
                viber: `viber://forward?text=${encodedText}`,
                vk: `https://vk.com/share.php?title=${encodedText}`
              };
              window.open(links[platform], '_blank');
            }
          };

          const resetAll = () => {
            setParticipants([]);
            setPurchases([]);
            setConsumption({});
            setSettlements([]);
            setPaymentStatuses({});
            setShowReset(false);
          };

          if (screen === 'splash') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center p-4">
                <div className="text-center">
                  <div className="mb-8 animate-bounce">
                    <div className="text-8xl">üéâ</div>
                  </div>
                  <h1 className="text-5xl font-bold text-white mb-4">Party Calculator</h1>
                  <p className="text-xl text-white/90">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è —á–µ—Å—Ç–Ω–æ–≥–æ<br />
                    —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤
                  </p>
                  <div className="mt-8">
                    <div className="inline-block animate-pulse">
                      <div className="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 pb-20">
              <div className="bg-white shadow-md sticky top-0 z-40">
                <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                  <h1 className="text-2xl font-bold text-indigo-600 flex items-center gap-2">
                    üéâ Party Calculator
                  </h1>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setShowHelp(true)}
                      className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg"
                    >
                      <Info size={20} />
                    </button>
                    <button
                      onClick={() => setShowReset(true)}
                      className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg"
                    >
                      <RotateCcw size={20} />
                    </button>
                  </div>
                </div>

                <div className="max-w-4xl mx-auto px-4 flex gap-1 border-t">
                  {[
                    { id: 'participants', icon: Users, label: '–£—á–∞—Å—Ç–Ω–∏–∫–∏' },
                    { id: 'purchases', icon: ShoppingCart, label: '–ü–æ–∫—É–ø–∫–∏' },
                    { id: 'consumption', icon: PieChart, label: '–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ' },
                    { id: 'results', icon: Calculator, label: '–†–∞—Å—á—ë—Ç—ã' }
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex-1 py-3 flex items-center justify-center gap-2 text-sm font-medium border-b-2 transition-colors ${
                        activeTab === tab.id
                          ? 'border-indigo-600 text-indigo-600'
                          : 'border-transparent text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      <tab.icon size={18} />
                      <span className="hidden sm:inline">{tab.label}</span>
                    </button>
                  ))}
                </div>
              </div>

              <div className="max-w-4xl mx-auto px-4 py-6">
                {activeTab === 'participants' && (
                  <div className="space-y-4">
                    <div className="bg-white rounded-xl p-6 shadow-sm">
                      <h2 className="text-lg font-bold text-gray-800 mb-4">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
                      <div className="space-y-3">
                        <input
                          type="text"
                          placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞"
                          value={participantForm.name}
                          onChange={(e) => setParticipantForm({ ...participantForm, name: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        />
                        <div className="relative">
                          <Phone size={18} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
                          <input
                            type="tel"
                            placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–¥–ª—è –°–ë–ü)"
                            value={participantForm.phone}
                            onChange={(e) => setParticipantForm({ ...participantForm, phone: e.target.value })}
                            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          />
                        </div>
                        <button
                          onClick={addParticipant}
                          className="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center gap-2"
                        >
                          <Plus size={18} />
                          {editingParticipant !== null ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞'}
                        </button>
                      </div>
                    </div>

                    {participants.length === 0 ? (
                      <div className="bg-white rounded-xl p-8 text-center shadow-sm">
                        <Users size={48} className="mx-auto text-gray-300 mb-3" />
                        <p className="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
                      </div>
                    ) : (
                      <div className="space-y-3">
                        {participants.map((p, i) => (
                          <div key={p.id} className="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between">
                            <div>
                              <p className="font-semibold text-gray-800">{p.name}</p>
                              {p.phone && (
                                <p className="text-sm text-gray-500 flex items-center gap-1">
                                  <Phone size={14} />
                                  {p.phone}
                                </p>
                              )}
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => {
                                  setParticipantForm({ name: p.name, phone: p.phone });
                                  setEditingParticipant(i);
                                }}
                                className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200"
                              >
                                –†–µ–¥.
                              </button>
                              <button
                                onClick={() => deleteParticipant(i)}
                                className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                              >
                                <X size={18} />
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {activeTab === 'purchases' && (
                  <div className="space-y-4">
                    {participants.length < 2 ? (
                      <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center">
                        <AlertCircle size={48} className="mx-auto text-yellow-600 mb-3" />
                        <p className="text-yellow-800 font-medium">–î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                      </div>
                    ) : (
                      <>
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                          <h2 className="text-lg font-bold text-gray-800 mb-4">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É</h2>
                          <div className="space-y-3">
                            <input
                              type="text"
                              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                              value={purchaseForm.name}
                              onChange={(e) => setPurchaseForm({ ...purchaseForm, name: e.target.value })}
                              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            />
                            <div className="grid grid-cols-2 gap-3">
                              <input
                                type="number"
                                placeholder="–¶–µ–Ω–∞"
                                value={purchaseForm.price}
                                onChange={(e) => setPurchaseForm({ ...purchaseForm, price: e.target.value })}
                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                              />
                              <input
                                type="number"
                                placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"
                                value={purchaseForm.quantity}
                                onChange={(e) => setPurchaseForm({ ...purchaseForm, quantity: e.target.value })}
                                className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                              />
                            </div>
                            <select
                              value={purchaseForm.buyer}
                              onChange={(e) => setPurchaseForm({ ...purchaseForm, buyer: e.target.value })}
                              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            >
                              <option value="">–ö—Ç–æ –∫—É–ø–∏–ª?</option>
                              {participants.map(p => (
                                <option key={p.id} value={p.name}>{p.name}</option>
                              ))}
                            </select>
                            <button
                              onClick={addPurchase}
                              className="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center gap-2"
                            >
                              <Plus size={18} />
                              {editingPurchase !== null ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É'}
                            </button>
                          </div>
                        </div>

                        {purchases.length === 0 ? (
                          <div className="bg-white rounded-xl p-8 text-center shadow-sm">
                            <ShoppingCart size={48} className="mx-auto text-gray-300 mb-3" />
                            <p className="text-gray-500">–î–æ–±–∞–≤—å—Ç–µ –ø–æ–∫—É–ø–∫–∏</p>
                          </div>
                        ) : (
                          <div className="space-y-3">
                            {purchases.map((p, i) => (
                              <div key={p.id} className="bg-white rounded-xl p-4 shadow-sm">
                                <div className="flex items-start justify-between mb-2">
                                  <div>
                                    <p className="font-semibold text-gray-800">{p.name}</p>
                                    <p className="text-sm text-gray-500">–ö—É–ø–∏–ª: {p.buyer}</p>
                                  </div>
                                  <button
                                    onClick={() => deletePurchase(i)}
                                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                                  >
                                    <X size={18} />
                                  </button>
                                </div>
                                <div className="flex items-center justify-between text-sm">
                                  <span className="text-gray-600">{p.quantity} √ó {p.price}‚ÇΩ</span>
                                  <span className="text-lg font-bold text-indigo-600">{p.total.toFixed(2)}‚ÇΩ</span>
                                </div>
                              </div>
                            ))}
                            <div className="bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl p-4 text-white">
                              <p className="text-sm opacity-90">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</p>
                              <p className="text-3xl font-bold">
                                {purchases.reduce((sum, p) => sum + p.total, 0).toFixed(2)}‚ÇΩ
                              </p>
                            </div>
                          </div>
                        )}
                      </>
                    )}
                  </div>
                )}

                {activeTab === 'consumption' && (
                  <div className="space-y-4">
                    {purchases.length === 0 ? (
                      <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center">
                        <AlertCircle size={48} className="mx-auto text-yellow-600 mb-3" />
                        <p className="text-yellow-800 font-medium">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–∫—É–ø–∫–∏</p>
                      </div>
                    ) : (
                      <>
                        <div className="flex gap-2">
                          <button
                            onClick={distributeAllEvenly}
                            className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700"
                          >
                            –í—Å—ë –ø–æ—Ä–æ–≤–Ω—É –Ω–∞ –≤—Å–µ—Ö
                          </button>
                        </div>

                        <div className="space-y-4">
                          {getGroupedPurchases().map(group => {
                            const status = getConsumptionStatus(group);
                            const statusColors = {
                              correct: 'border-green-300 bg-green-50',
                              under: 'border-yellow-300 bg-yellow-50',
                              over: 'border-red-300 bg-red-50'
                            };

                            return (
                              <div key={group.key} className={`bg-white rounded-xl p-4 shadow-sm border-2 ${statusColors[status]}`}>
                                <div className="flex items-center justify-between mb-3">
                                  <div>
                                    <h3 className="font-bold text-gray-800">{group.name}</h3>
                                    <p className="text-sm text-gray-500">{group.price}‚ÇΩ –∑–∞ —à—Ç. ‚Ä¢ –í—Å–µ–≥–æ: {group.totalQuantity}</p>
                                  </div>
                                  <button
                                    onClick={() => distributeEvenly(group)}
                                    className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200"
                                  >
                                    –ü–æ—Ä–æ–≤–Ω—É
                                  </button>
                                </div>
                                <div className="space-y-2">
                                  {participants.map(p => (
                                    <div key={p.id} className="flex items-center gap-3">
                                      <span className="text-sm text-gray-700 w-24 truncate">{p.name}</span>
                                      <input
                                        type="number"
                                        step="0.1"
                                        placeholder="0"
                                        value={consumption[`${group.key}-${p.id}`] || ''}
                                        onChange={(e) => updateConsumption(group.key, p.id, e.target.value)}
                                        className="flex-1 px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                      />
                                    </div>
                                  ))}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </>
                    )}
                  </div>
                )}

                {activeTab === 'results' && (
                  <div className="space-y-4">
                    {settlements.length === 0 ? (
                      <div className="space-y-4">
                        <button
                          onClick={calculateSettlements}
                          disabled={purchases.length === 0}
                          className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                          <Calculator size={24} />
                          –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã
                        </button>

                        {purchases.length > 0 && (
                          <div className="space-y-3">
                            <h3 className="font-bold text-gray-800">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</h3>
                            {getResults().map(r => (
                              <div
                                key={r.name}
                                className={`rounded-xl p-4 ${
                                  r.balance > 0 ? 'bg-green-50 border-2 border-green-200' :
                                  r.balance < 0 ? 'bg-red-50 border-2 border-red-200' :
                                  'bg-gray-50 border-2 border-gray-200'
                                }`}
                              >
                                <div className="flex items-center justify-between">
                                  <div>
                                    <p className="font-semibold text-gray-800">{r.name}</p>
                                    {r.phone && (
                                      <p className="text-xs text-gray-500 flex items-center gap-1">
                                        <Phone size={12} />
                                        {r.phone}
                                      </p>
                                    )}
                                    <p className="text-xs text-gray-600">
                                      –ü–æ—Ç—Ä–∞—Ç–∏–ª: {r.spent.toFixed(2)}‚ÇΩ | –î–æ–ª–∂–µ–Ω –±—ã–ª: {r.owes.toFixed(2)}‚ÇΩ
                                    </p>
                                  </div>
                                  <div className="text-right">
                                    <p className={`text-2xl font-bold ${
                                      r.balance > 0 ? 'text-green-600' :
                                      r.balance < 0 ? 'text-red-600' :
                                      'text-gray-600'
                                    }`}>
                                      {r.balance > 0 ? '+' : ''}{r.balance.toFixed(2)}‚ÇΩ
                                    </p>
                                    <p className="text-xs text-gray-500">
                                      {r.balance > 0 ? '‚úÖ –ü–µ—Ä–µ–ø–ª–∞—Ç–∏–ª' :
                                       r.balance < 0 ? '‚ùå –ù–µ–¥–æ–ø–ª–∞—Ç–∏–ª' :
                                       '‚ûñ –í—Å—ë —Å–æ—à–ª–æ—Å—å'}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="space-y-4">
                        <div className="bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl p-6 text-white">
                          <h2 className="text-xl font-bold mb-2">üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã</h2>
                          <p className="text-sm opacity-90">
                            {settlements.filter(s => paymentStatuses[s.id] === 'paid').length} –∏–∑ {settlements.length} –æ–ø–ª–∞—á–µ–Ω–æ
                          </p>
                        </div>

                        <div className="space-y-3">
                          {settlements.map(transaction => {
                            const status = paymentStatuses[transaction.id] || 'unpaid';
                            const statusConfig = {
                              unpaid: { icon: X, color: 'text-red-600', bg: 'bg-red-50', border: 'border-red-200', label: '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ' },
                              pending: { icon: Clock, color: 'text-yellow-600', bg: 'bg-yellow-50', border: 'border-yellow-200', label: '–û–∂–∏–¥–∞–µ—Ç' },
                              paid: { icon: Check, color: 'text-green-600', bg: 'bg-green-50', border: 'border-green-200', label: '–û–ø–ª–∞—á–µ–Ω–æ' }
                            };
                            const StatusIcon = statusConfig[status].icon;

                            return (
                              <div
                                key={transaction.id}
                                className={`bg-white rounded-xl p-4 shadow-sm border-2 ${statusConfig[status].border}`}
                              >
                                <div className="flex items-center justify-between mb-3">
                                  <div className="flex-1">
                                    <p className="font-semibold text-gray-800">
                                      {transaction.from} ‚Üí {transaction.to}
                                    </p>
                                    {transaction.toPhone && (
                                      <p className="text-xs text-gray-500 flex items-center gap-1 mt-1">
                                        <Phone size={12} />
                                        {transaction.toPhone}
                                      </p>
                                    )}
                                    <p className="text-2xl font-bold text-indigo-600 mt-1">
                                      {transaction.amount.toFixed(2)}‚ÇΩ
                                    </p>
                                  </div>
                                  <StatusIcon className={`w-8 h-8 ${statusConfig[status].color}`} />
                                </div>

                                <div className="flex gap-2">
                                  {status === 'unpaid' && (
                                    <>
                                      <button
                                        onClick={() => initiatePayment(transaction)}
                                        className="flex-1 bg-indigo-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700"
                                      >
                                        üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –°–ë–ü
                                      </button>
                                      <button
                                        onClick={() => updatePaymentStatus(transaction.id, 'paid')}
                                        className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg text-sm font-semibold hover:bg-gray-300"
                                      >
                                        –£–∂–µ –æ–ø–ª–∞—Ç–∏–ª
                                      </button>
                                    </>
                                  )}
                                  {status === 'pending' && (
                                    <>
                                      <button
                                        onClick={() => updatePaymentStatus(transaction.id, 'paid')}
                                        className="flex-1 bg-green-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-green-700"
                                      >
                                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                                      </button>
                                      <button
                                        onClick={() => updatePaymentStatus(transaction.id, 'unpaid')}
                                        className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg text-sm font-semibold hover:bg-gray-300"
                                      >
                                        –û—Ç–º–µ–Ω–∏—Ç—å
                                      </button>
                                    </>
                                  )}
                                  {status === 'paid' && (
                                    <button
                                      onClick={() => updatePaymentStatus(transaction.id, 'unpaid')}
                                      className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg text-sm font-semibold hover:bg-gray-300"
                                    >
                                      –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω–æ–µ
                                    </button>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm space-y-3">
                          <h3 className="font-bold text-gray-800 flex items-center gap-2">
                            <Send size={20} />
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç—ã
                          </h3>
                          <div className="grid grid-cols-2 gap-2">
                            <button
                              onClick={() => shareToMessenger('telegram')}
                              className="bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600"
                            >
                              Telegram
                            </button>
                            <button
                              onClick={() => shareToMessenger('whatsapp')}
                              className="bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700"
                            >
                              WhatsApp
                            </button>
                            <button
                              onClick={() => shareToMessenger('viber')}
                              className="bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700"
                            >
                              Viber
                            </button>
                            <button
                              onClick={() => shareToMessenger('vk')}
                              className="bg-blue-700 text-white py-2 rounded-lg font-semibold hover:bg-blue-800"
                            >
                              VK
                            </button>
                          </div>
                          <button
                            onClick={() => {
                              setSettlements([]);
                              setPaymentStatuses({});
                            }}
                            className="w-full bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300"
                          >
                            –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∑–∞–Ω–æ–≤–æ
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>

              {showHelp && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-xl font-bold text-gray-800">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</h3>
                      <button onClick={() => setShowHelp(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                        <X size={20} />
                      </button>
                    </div>
                    
                    <div className="space-y-4 text-sm">
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-1">1Ô∏è‚É£ –£—á–∞—Å—Ç–Ω–∏–∫–∏</h4>
                        <p className="text-gray-600">–î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ—Ö –∏ –∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω—ã –¥–ª—è –°–ë–ü</p>
                      </div>
                      
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-1">2Ô∏è‚É£ –ü–æ–∫—É–ø–∫–∏</h4>
                        <p className="text-gray-600">–í–Ω–µ—Å–∏—Ç–µ –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</p>
                      </div>
                      
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-1">3Ô∏è‚É£ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</h4>
                        <p className="text-gray-600">–£–∫–∞–∂–∏—Ç–µ –∫—Ç–æ —Å–∫–æ–ª—å–∫–æ —Å—ä–µ–ª/–≤—ã–ø–∏–ª</p>
                      </div>
                      
                      <div>
                        <h4 className="font-semibold text-gray-700 mb-1">4Ô∏è‚É£ –†–∞—Å—á—ë—Ç—ã</h4>
                        <p className="text-gray-600">–ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥—ã –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ –°–ë–ü!</p>
                      </div>

                      <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-3 mt-4">
                        <p className="text-indigo-800 text-xs">
                          üí° <strong>–°–æ–≤–µ—Ç:</strong> –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ ‚Äî –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ —á–µ—Ä–µ–∑ –°–ë–ü –Ω–æ–º–µ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
                        </p>
                      </div>
                    </div>

                    <button
                      onClick={() => setShowHelp(false)}
                      className="w-full mt-6 bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700"
                    >
                      –ü–æ–Ω—è—Ç–Ω–æ
                    </button>
                  </div>
                </div>
              )}

              {showReset && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-2xl p-6 max-w-sm w-full">
                    <h3 className="text-xl font-bold text-gray-800 mb-3">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?</h3>
                    <p className="text-gray-600 mb-6">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                    <div className="flex gap-3">
                      <button
                        onClick={() => setShowReset(false)}
                        className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300"
                      >
                        –û—Ç–º–µ–Ω–∞
                      </button>
                      <button
                        onClick={resetAll}
                        className="flex-1 bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700"
                      >
                        –°–±—Ä–æ—Å–∏—Ç—å
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        ReactDOM.render(
            React.createElement(PartyCalculatorTelegram),
            document.getElementById('root')
        );
    </script>
</body>
</html>
