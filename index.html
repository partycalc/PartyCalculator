<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Party Calculator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow-x: hidden;
        }
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel" data-type="module">
        const { useState, useEffect } = React;
        
        // Lucide icons as inline SVG
        const Users = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );
        
        const ShoppingCart = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="9" cy="21" r="1"/>
                <circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
        );
        
        const Calculator = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="16" y1="14" x2="16" y2="14"/>
                <line x1="8" y1="14" x2="8" y2="14"/>
                <line x1="12" y1="14" x2="12" y2="14"/>
                <line x1="16" y1="18" x2="16" y2="18"/>
                <line x1="8" y1="18" x2="8" y2="18"/>
                <line x1="12" y1="18" x2="12" y2="18"/>
            </svg>
        );
        
        const TrendingUp = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                <polyline points="17 6 23 6 23 12"/>
            </svg>
        );
        
        const Plus = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );
        
        const Edit2 = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
        );
        
        const Trash2 = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
        );
        
        const Info = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        );
        
        const RotateCcw = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"/>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
        );
        
        const CheckCircle = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );
        
        const Clock = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );
        
        const XCircle = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
        );
        
        const Copy = (props) => (
            <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
        );

        const PartyCalculator = () => {
          const [screen, setScreen] = useState('splash');
          const [activeTab, setActiveTab] = useState('participants');
          const [eventName, setEventName] = useState('');
          const [participants, setParticipants] = useState([]);
          const [purchases, setPurchases] = useState([]);
          const [consumption, setConsumption] = useState({});
          const [newParticipant, setNewParticipant] = useState({ name: '' });
          const [editingParticipant, setEditingParticipant] = useState(null);
          const [editingPurchase, setEditingPurchase] = useState(null);
          const [newPurchase, setNewPurchase] = useState({
            product: '',
            price: '',
            quantity: '',
            buyer: ''
          });
          const [settlements, setSettlements] = useState([]);
          const [paymentStatuses, setPaymentStatuses] = useState({});
          const [showResetConfirm, setShowResetConfirm] = useState(false);
          const [showHelp, setShowHelp] = useState(false);
          const [emailCopied, setEmailCopied] = useState(false);

          const isTelegramApp = () => {
            return window.Telegram?.WebApp?.initData !== undefined;
          };

          useEffect(() => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            if (window.Telegram?.WebApp) {
              window.Telegram.WebApp.ready();
              window.Telegram.WebApp.expand();
            }
            
            if (screen === 'splash') {
              const timer = setTimeout(() => {
                setScreen('main');
              }, 2500);
              return () => clearTimeout(timer);
            }
          }, [screen]);

          const resetAll = () => {
            setScreen('main');
            setActiveTab('participants');
            setEventName('');
            setParticipants([]);
            setPurchases([]);
            setConsumption({});
            setNewParticipant({ name: '' });
            setNewPurchase({
              product: '',
              price: '',
              quantity: '',
              buyer: ''
            });
            setSettlements([]);
            setPaymentStatuses({});
            setShowResetConfirm(false);
          };

          const createEvent = () => {
            if (eventName.trim()) {
              setScreen('tabs');
              setActiveTab('participants');
            }
          };

          const addParticipant = () => {
            if (newParticipant.name.trim() && !participants.find(p => p.name === newParticipant.name)) {
              setParticipants([...participants, { name: newParticipant.name, id: Date.now() }]);
              setNewParticipant({ name: '' });
            }
          };

          const copyEmail = () => {
            navigator.clipboard.writeText('e@mailvladimir.ru').then(() => {
              setEmailCopied(true);
              setTimeout(() => setEmailCopied(false), 2000);
            });
          };

          if (screen === 'splash') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center p-4">
                <div className="text-center">
                  <div className="mb-8 animate-bounce">
                    <div className="text-8xl">üéâ</div>
                  </div>
                  <h1 className="text-5xl font-bold text-white mb-4">Party Calculator</h1>
                  <p className="text-xl text-white/90">
                    –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤<br />
                    –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫, –ø–∏–∫–Ω–∏–∫–æ–≤ –∏ –ø–æ–µ–∑–¥–æ–∫
                  </p>
                  <div className="mt-8">
                    <div className="inline-block animate-pulse">
                      <div className="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
                    </div>
                  </div>
                  <p className="text-white/70 text-sm mt-4">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
              </div>
            );
          }

          if (screen === 'main') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                <div className="max-w-md mx-auto mt-20">
                  <div className="bg-white rounded-3xl shadow-2xl p-8">
                    <div className="text-center mb-8">
                      <div className="text-6xl mb-4">üéâ</div>
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">Party Calculator</h1>
                      <p className="text-gray-600">–ß–µ—Å—Ç–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤</p>
                    </div>
                    <input
                      type="text"
                      placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"
                      value={eventName}
                      onChange={(e) => setEventName(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && createEvent()}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none mb-4"
                    />
                    <button
                      onClick={createEvent}
                      className="w-full bg-indigo-600 text-white px-6 py-3 rounded-xl hover:bg-indigo-700 font-semibold"
                    >
                      –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50">
              <div className="bg-white p-4 text-center">
                <h1 className="text-xl font-bold">{eventName}</h1>
                <p className="text-sm text-gray-500">–†–∞–±–æ—Ç–∞–µ—Ç! –î–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
              </div>
              <div className="p-4">
                <div className="bg-white p-4 rounded-lg">
                  <input
                    type="text"
                    placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞"
                    value={newParticipant.name}
                    onChange={(e) => setNewParticipant({name: e.target.value})}
                    onKeyPress={(e) => e.key === 'Enter' && addParticipant()}
                    className="w-full px-4 py-2 border rounded mb-2"
                  />
                  <button
                    onClick={addParticipant}
                    className="w-full bg-indigo-600 text-white py-2 rounded"
                  >
                    –î–æ–±–∞–≤–∏—Ç—å
                  </button>
                </div>
                <div className="mt-4 space-y-2">
                  {participants.map(p => (
                    <div key={p.id} className="bg-white p-3 rounded">
                      {p.name}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<PartyCalculator />, document.getElementById('root'));
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>